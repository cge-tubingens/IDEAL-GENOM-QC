# IDEAL-GENOM-QC Pipeline Configuration Template
# This template demonstrates the flexible pipeline configuration system
# Enable/disable steps as needed for your specific workflow

pipeline:
  name: "ideal_genom_test"
  base_output_dir: "path/to/output/directory"
  
  # Pipeline steps - enable/disable by including/excluding from this list
  # Steps will be executed in the order specified here
  steps:
    
    # Step 1: Sample Quality Control
    # Performs individual-level QC including missing data, sex check, heterozygosity, relatedness
    - name: "sample_qc"
      enabled: true
      module: "ideal_genom.qc.sample_qc"
      class: "SampleQC"
      init_params:
        input_path: "path/to/input/directory"
        input_name: "input_dataset"
        output_path: "${base_output_dir}"
        output_name: "input_dataset_sampleQCed"
        high_ld_regions_file: "/path/to/high_ld_regions.txt"
        build: "38"
      execute_params:
        # Sample QC parameters
        rename_snp: true
        hh_to_missing: true
        use_kinship: true
        ind_pair: [50, 5, 0.2]  # LD pruning: [window_size, step_size, r2_threshold]
        mind: 0.2               # Missing data threshold per individual
        sex_check: [0.2, 0.8]   # F coefficient thresholds [female_max, male_min]
        maf: 0.01               # Minor allele frequency
        het_deviation: 3        # Heterozygosity standard deviations
        kinship: 0.354          # Kinship coefficient threshold
        ibd_threshold: 0.185    # IBD threshold for duplicates

    # Step 2: Ancestry Quality Control
    # Merges with reference populations and performs ancestry inference
    - name: "ancestry_qc"
      enabled: false
      module: "ideal_genom.qc.ancestry_qc"
      class: "AncestryQC"  # Note: May need to be updated based on actual class
      init_params:
        input_path: "${steps.sample_qc.clean_dir}"
        input_name: "${steps.sample_qc.output_name}"
        output_path: "${base_output_dir}"
        output_name: "input_dataset_ancestryQCed"
        high_ld_regions_file: "/path/to/high_ld_regions.txt"
        reference_files:
          bed: "/path/to/1000genomes/reference.bed"
          bim: "/path/to/1000genomes/reference.bim"
          fam: "/path/to/1000genomes/reference.fam"
        build: "38"
      execute_params:
        # Ancestry QC parameters
        ind_pair: [50, 5, 0.2]     # LD pruning for PCA
        pca: 10                    # Number of principal components
        maf: 0.01                  # MAF threshold for PCA variants
        ref_threshold: 4           # SD threshold for reference outliers
        stu_threshold: 4           # SD threshold for study outliers
        reference_pop: "SAS"       # Reference population (EUR, AFR, AMR, EAS, SAS)
        num_pcs: 10               # Number of PCs for ancestry assignment
        distance_metric: "infinity"

    # Step 3: Variant Quality Control
    # Performs variant-level QC including HWE, missing data, MAF filtering
    - name: "variant_qc"
      enabled: true
      module: "ideal_genom.qc.variant_qc"
      class: "VariantQC"
      init_params:
        input_path: #"${steps.ancestry_qc.clean_dir}"
        input_name: "${steps.ancestry_qc.output_name}"
        output_path: "${base_output_dir}"
        output_name: "input_dataset_variantQCed"
      execute_params:
        # Variant QC parameters
        miss_data_rate: 0.2
        diff_genotype_rate: 1.0e-5
        geno: 0.1                # Missing data threshold per variant
        maf: 0.001                # Minor allele frequency threshold
        hwe: 5.0e-8                 # Hardy-Weinberg equilibrium p-value
        chr_y: 24                 # Y chromosome identifier

    # Step 4: Population Analysis / Dimensionality Reduction
    # Performs PCA, UMAP, and other population structure analyses
    - name: "dimensionality_reduction"
      enabled: true
      module: "ideal_genom.population.projection"
      class: "DimensionalityReductionPipeline"
      init_params:
        input_path: "${steps.variant_qc.clean_dir}"
        input_name: "${steps.variant_qc.output_name}"
        output_path: "${base_output_dir}"
        build: "38"
        high_ld_regions_file: "/path/to/high_ld_regions.txt"
        generate_plot: true
      execute_params:
        # PCA parameters
        pca_params:
          pca: 10                    # Number of PCA components
        force_pca_recompute: false
        
        # UMAP parameters  
        run_umap: true
        umap_params:
          n_neighbors: 15            # UMAP n_neighbors parameter
          min_dist: 0.1              # UMAP min_dist parameter
          n_components: 2            # UMAP output dimensions
        
        # t-SNE parameters
        run_tsne: true
        tsne_params:
          perplexity: 30             # t-SNE perplexity parameter
        
        # Plotting parameters
        case_control_markers: true
        plot_format: "png"           # Plot output format
        dpi: 600                     # Plot resolution
        include_pca: true
        
        # Grid-specific parameters
        save_all_coordinates: true
        generate_all_plots: true
        grid_summary: true

# Global settings
settings:
  # Logging configuration
  logging:
    level: "INFO"              # DEBUG, INFO, WARNING, ERROR
    file_logging: true         # Enable file logging
    console_logging: true      # Enable console logging
  
  # Resource management
  resources:
    max_memory: null           # Maximum memory usage (null for auto-detect)
    max_threads: null          # Maximum threads (null for auto-detect)
  
  # File management
  files:
    keep_intermediate: true    # Preserve intermediate files
    compress_outputs: false    # Compress output files
    overwrite_existing: false  # Overwrite existing output files

# Alternative workflow examples:
# 
# For Sample QC + Variant QC only (skip ancestry):
# Simply remove or set enabled: false for the ancestry_qc step
# and update variant_qc input_path to: "${steps.sample_qc.output_path}"
#
# For Population Analysis only:
# Remove or disable all other steps and provide direct input paths:
# input_path: "/path/to/preprocessed/data"
# input_name: "preprocessed_dataset"
#
# For resuming from a specific step:
# Set enabled: false for completed steps and update input paths accordingly